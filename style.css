/* ===== Base page ===== */
html, body {
  margin: 0;
  padding: 0;
  height: 100vh;
  background: #cceeff;
  overflow: hidden;
  touch-action: none;
  -webkit-tap-highlight-color: transparent;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
}

/* ===== Unified Top Bar ===== */
/* Slim 3-column top bar */
#topBar{
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 9999;            /* higher than the canvas/video */
  padding-top: calc(6px + env(safe-area-inset-top, 0px));
  display: grid;
  grid-template-columns: 1fr auto 1fr; /* left | center | right */
  align-items: center;
  gap: 8px;
  padding: 6px 10px; /* slim */
  background: #ffffff;
  border-bottom: 1px solid rgba(0,0,0,.08);
  white-space: nowrap; /* keep it all on one row */
}
/* Hide top bar during login/mode pick; show during gameplay */
#topBar.hidden{ display: none !important; }
body.login-active #topBar,
body.mode-pick   #topBar{ display: none !important; }
body.game-active #topBar{ display: grid; }     /* your top bar uses CSS grid */

/* ===== Left: legacy selector (kept for compatibility) ===== */
#modeBar { display: inline-flex; align-items: center; gap: 8px; justify-self: start; }
#modeBar select {
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,.15);
  padding: 6px 8px;
  background: white;
}
#modeBar.compact select { max-width: 120px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; }

/* ===== Left cluster: Score & Time ===== */
#overlayUI{
  grid-column: 1;
  justify-self: start;
}
.hud{
  display: flex;
  gap: 8px;
  align-items: center; /* vertical align with other chips */
}

/* ===== Center: Bio indicator chip ===== */
#bioChip{
  grid-column: 2;
  justify-self: center;
  align-self: center;
}

/* ===== Right: Mode chip + Camera (wrapped) ===== */
#rightWrap{
  grid-column: 3;
  justify-self: end;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Mode chip itself (text updated by JS; hidden outside Bio by JS) */
#modeChip{
  align-self: center;
}

/* Camera icon button (hidden by default; JS decides when to show) */
#cameraBtn{
  display: none;
  align-self: center;
}

/* Consistent chip sizing & baseline */
.chip{
  display: inline-flex;
  align-items: center;
  height: 28px;            /* slim, consistent height */
  line-height: 28px;
  padding: 0 10px;
  margin: 0;
  background: #eef6ff;
  color: #0b2a45;
  border-radius: 14px;
}

.hiddenChip { visibility: hidden; opacity: 0; pointer-events: none; }
.hidden { display: none !important; }

/* Status line under login input */
.loginStatus { margin-top: 8px; font-size: 0.92rem; line-height: 1.3; opacity: .9;}
.loginStatus.info { color: #555; }
.loginStatus.ok   { color: #2e7d32; }
.loginStatus.err  { color: #b00020; }

/* General buttons (incl. camera icon container) */
.iconBtn {
  display: inline-flex; align-items: center; justify-content: center;
  padding: 6px 12px;
  min-height: 32px;
  border-radius: 10px; border: 0;
  background: #0077cc; color: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
  cursor: pointer;
}
.iconBtn.small { padding: 4px 8px; min-height: 28px; border-radius: 8px; }
.iconBtn:active { transform: translateY(1px) scale(0.98); }
.iconBtn.is-busy { opacity: .6; pointer-events: none; }

/* ===== Modal ===== */
.modal, .modal * { touch-action: auto; }
.modal.hidden { display: none; }
.modal { position: fixed; inset: 0; z-index: 30; background: rgba(0,0,0,.35); display: grid; place-items: center; }
.modalContent {
  width: min(560px, 100vw); 
  background: #fff; 
  border-top-left-radius: 16px; 
  border-top-right-radius: 16px;
  padding: 12px 14px 16px; 
  padding-bottom: calc(16px + env(safe-area-inset-bottom));
  box-shadow: 0 -6px 24px rgba(0,0,0,.2);
}
.modalHeader { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.modalRow { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin: 8px 0; }
.modalRow select { flex: 1 1 auto; max-width: 100%; border-radius: 10px; border: 1px solid rgba(0,0,0,.15); padding: 8px 10px; background: #fff; }
.previewWrap { margin-top: 8px; display: flex; justify-content: center; }
.modalPreview { width: 220px; height: auto; border-radius: 8px; box-shadow: 0 6px 16px rgba(0,0,0,.18); transform: scaleX(-1); }
/* Ensure all centered modals fit the viewport and can scroll internally */
.modal.centered .modalContent {
  max-height: 80vh;         /* keep within viewport */
  overflow: auto;           /* scroll inside the card */
  width: min(520px, 92vw);  /* shrink on phones */
}

.modalRow.stacked { flex-direction: column; align-items: stretch; }
.modalRow.stacked .iconBtn { width: 100%; }

#loginModal { z-index: 1000; }
#loginProgressModal { z-index: 2000; } /* ensure itâ€™s above */

/* Screen-reader-only helper */
.srOnly { position: absolute; left: -9999px; }

/* ===== Centered end-game UI ===== */
.centerMsg {
  position: fixed; left: 50%; top: 50%; transform: translate(-50%, -60%);
  font-size: 28px; font-weight: 800; color: #00324d; text-align: center;
  text-shadow: 0 2px 6px rgba(0,0,0,.25); z-index: 20;
}
#restartBtn {
  position: fixed; left: 50%; top: calc(50% + 24px); transform: translateX(-50%); z-index: 20;
  border: 0; border-radius: 14px; padding: 12px 16px; font-size: 16px; font-weight: 700;
  background: white; box-shadow: 0 8px 20px rgba(0,0,0,.15); cursor: pointer; display: none;
}
#restartBtn:active { transform: translateX(-50%) translateY(1px); }

/* ===== Hidden webcam (rendering offscreen) ===== */
.hiddenVideo {
  position: fixed; left: -9999px; top: 0;
  width: 320px; height: auto; opacity: 0; pointer-events: none;
}

/* When preview is enabled, show in lower-right of the viewport */
#webcamPreview.preview {
  position: fixed; right: 16px; bottom: 16px; top: auto; opacity: 1;
  width: 160px; height: auto; border-radius: 8px; box-shadow: 0 6px 20px rgba(0,0,0,.2);
  transform: scaleX(-1); transform-origin: center; pointer-events: none; z-index: 9998;
}

/* Utility: hidden but keeps element alive */
.camHidden { width: 1px !important; height: 1px !important; opacity: 0 !important; box-shadow: none !important; border-radius: 0 !important; }

/* ===== Responsive tweaks ===== */
@media (max-width: 420px) {
  #modeBar.compact select { max-width: 96px; }
  .modalPreview { width: 180px; }
}

@media (max-width: 480px) {
  #loginModal .modalRow {
    flex-direction: column;     /* stack input and button */
    align-items: stretch;
  }
  #loginModal input[type="text"] { width: 100%; }
  #loginModal .iconBtn.small { width: 100%; }  /* full-width OK button */
}

/* ===== Splash Screen ===== */
#splash {
  position: fixed;
  inset: 0;
  z-index: 9999;
  display: grid;
  place-items: center;
  background: linear-gradient(160deg, #9ad4ff 0%, #b8e1ff 40%, #eef7ff 100%);
  opacity: 0;
  pointer-events: none;
  transition: opacity 400ms ease;
}

/* Reduce-motion friendly */
@media (prefers-reduced-motion: reduce) {
  #splash { transition: none; }
}

#splash.is-visible {
  opacity: 1;
  pointer-events: auto;
}

#splash.is-fading-out {
  opacity: 0;
  pointer-events: none;
}

.splash-inner {
  text-align: center;
  padding: 2rem 2.5rem;
  border-radius: 20px;
  background: rgba(255, 255, 255, 0.35);
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
  backdrop-filter: blur(6px);
}

.splash-title {
  margin: 0 0 0.4rem 0;
  font-size: clamp(2rem, 6vw, 3.2rem);
  line-height: 1.1;
  letter-spacing: 0.5px;
  color: #0c2a43;
  text-shadow: 0 1px 0 rgba(255,255,255,0.25);
}

.splash-subtitle {
  margin: 0;
  font-size: clamp(1rem, 3.2vw, 1.25rem);
  color: #1a4366;
  opacity: 0.9;
}

/* Make sure this sits above your top bar or other fixed UI */
.top-bar, header, nav {
  position: relative;
  z-index: 10;
}

/* ===== Login Modal overrides (center the dialog) ===== */
#loginModal { place-items: center; }
#loginModal .modalContent {
  border-radius: 16px;            /* full-rounded when centered */
  border-top-left-radius: 16px;
  border-top-right-radius: 16px;
}
#loginModal input[type="text"] {
  flex: 1 1 auto;
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,.15);
  padding: 8px 10px;
}
#loginModal .iconBtn.small { min-width: 64px; }

/* Hide top bar while logging in (no UI until username set) */
body.login-active #topBar { display: none; }



/* Keep positioning static (avoid accidental offsets from older rules) */
#overlayUI, #bioChip, #modeChip, #cameraBtn { position: static; }

/* Prevent iOS input auto-zoom by ensuring 16px+ */
html { -webkit-text-size-adjust: 100%; }
#loginModal input[type="text"],
#loginModal select,
#loginModal .iconBtn { font-size: 16px; line-height: 1.2; }

/* Let the centered modals scroll internally */
.modal.centered .modalContent {
  max-height: 80vh;
  overflow: auto;
  -webkit-overflow-scrolling: touch;   /* smooth iOS scrolling */
  overscroll-behavior: contain;
  width: min(520px, 92vw);
}

/* On small phones, stack input+OK and anchor the login dialog near the keyboard */
@media (max-width: 480px) {
  
  #loginModal .modalContent {
    width: 100vw;
    max-width: 100vw;
    border-radius: 16px 16px 0 0;
    max-height: 70vh;                   /* a bit shorter so OK stays visible */
  }
  #loginModal .modalRow {
    flex-direction: column;
    align-items: stretch;
  }
  #loginModal input[type="text"] { width: 100%; }
  #loginModal .iconBtn.small    { width: 100%; }
}

/* Post-game: remove the "X" so players must choose Play again or Change mode */
#postGameClose { display: none; }
#postGameModal{ place-items: end center; z-index: 15;background: rgba(0,0,0,.20);}    /* bottom sheet */