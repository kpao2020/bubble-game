/* =========================================================
 * Popping Bubbles — Consolidated Stylesheet (v8.6.7)
 * Owner: Ken Pao
 *
 * Organization:
 *  1) Base & Resets
 *  2) Top Bar (layout & chips)
 *  3) Buttons (global + variants)
 *  4) Modals (global) + Centered Modals
 *  5) Mode Picker (modal-specific)
 *  6) Splash Screen
 *  7) Login Modal overrides
 *  8) Hidden Webcam & Preview
 *  9) Centered End-game UI (overlay)
 * 10) Post-game Modal (bottom sheet behavior)
 * 11) Responsive Tweaks
 * 12) Utilities
 *
 * Notes:
 * - Mode chip color per mode is handled via body classes:
 *     body.mode-classic  #modeChip { ... }
 *     body.mode-challenge #modeChip { ... }
 *     body.mode-mood      #modeChip { ... }
 *   (Wired in JS setBodyModeClass())
 * ========================================================= */

/* v9.2.10 — Consolidate survey styles: remove earlier duplicate, keep final block */
/* v9.2.11 — Show post-game Close button (was hidden) */
/* v9.2.12 — Remove unused #modeBar rules + media tweak */

/* ========== 1) Base & Resets ========== */
html, body {
  margin: 0;
  padding: 0;
  height: 100vh;
  background: #cceeff;
  overflow: hidden;
  touch-action: none;
  -webkit-tap-highlight-color: transparent;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
}
html { -webkit-text-size-adjust: 100%; }

/* ========== 2) Top Bar (layout & chips) ========== */
#topBar{
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 9999;
  padding-top: calc(6px + env(safe-area-inset-top, 0px));
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  background: #ffffff;
  border-bottom: 1px solid rgba(0,0,0,.08);
  white-space: nowrap;
}
#topBar.hidden{ display: none !important; }
body.login-active #topBar,
body.mode-pick   #topBar{ display: none !important; }
body.game-active #topBar{ display: grid; }

#overlayUI{ grid-column: 1; justify-self: start; }
.hud{ display: flex; gap: 8px; align-items: center; }

#moodChip{ grid-column: 2; justify-self: center; align-self: center; }

#rightWrap{ grid-column: 3; justify-self: end; display: flex; align-items: center; gap: 8px; }

#modeChip{ align-self: center; }

/* Per-mode background */
body.mode-classic  #modeChip { background: #4da6ff; color: #ffffff; }
body.mode-challenge #modeChip { background: #ff944d; color: #ffffff; }
body.mode-mood      #modeChip { background: #66cc66; color: #0b2a45; }

#cameraBtn {
  display: none;
  align-self: center;
  background: rgba(0,0,0,.12);
  border-radius: 12px;
}

.chip{
  display: inline-flex;
  align-items: center;
  height: 28px;
  line-height: 28px;
  padding: 0 10px;
  margin: 0;
  background: #eef6ff;
  color: #0b2a45;
  border-radius: 14px;
}

/* ========== 3) Buttons ========== */
.iconBtn {
  display: inline-flex; align-items: center; justify-content: center;
  padding: 10px;
  min-width: 44px; min-height: 44px;
  border-radius: 12px;
  background: #0077cc; color: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
  cursor: pointer;
  user-select: none; -webkit-user-select: none;
  transition: transform 120ms ease, box-shadow 150ms ease, background 150ms ease, opacity 150ms ease;
}
.iconBtn.small { padding: 8px; min-width: 40px; min-height: 40px; border-radius: 10px; }
.iconBtn:hover  { box-shadow: 0 4px 14px rgba(0,0,0,.18); }
.iconBtn:active { transform: translateY(1px) scale(0.96); box-shadow: 0 1px 6px rgba(0,0,0,.15); }
.iconBtn:focus-visible { outline: 3px solid rgba(0,119,204,.5); outline-offset: 2px; }

/* ========== 4) Modals ========== */
.modal, .modal * { touch-action: auto; }
.modal.hidden { display: none; }
.modal {
  position: fixed; inset: 0; z-index: 30;
  background: rgba(0,0,0,.35);
  display: grid; place-items: center;
}
.modalContent {
  width: min(560px, 100vw);
  background: #fff;
  border-radius: 16px;
  padding: 12px 14px 16px;
  padding-bottom: calc(16px + env(safe-area-inset-bottom));
  box-shadow: 0 -6px 24px rgba(0,0,0,.2);
  box-sizing: border-box;
}
.modalHeader { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.modalRow { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin: 8px 0; }
.modalRow.stacked { flex-direction: column; align-items: stretch; }
.modalRow select { flex: 1 1 auto; max-width: 100%; border-radius: 10px; border: 1px solid rgba(0,0,0,.15); padding: 8px 10px; background: #fff; }

.previewWrap { margin-top: 8px; display: flex; justify-content: center; }
.modalPreview { width: 220px; height: auto; border-radius: 8px; box-shadow: 0 6px 16px rgba(0,0,0,.18); transform: scaleX(-1); }

.modal.centered .modalContent {
  max-height: 80vh;
  overflow: auto;
  width: min(520px, 92vw);
  box-sizing: border-box;
}

/* ========== 5) Mode Picker ========== */
#modeModal .modalHeader { justify-content: center; }
#modeModal #modeTitle { text-align: center; width: 100%; }
#modeModal .modalRow.stacked { align-items: center; gap: 12px; }

#modeModal .iconBtn {
  width: 88px; height: 88px; padding: 8px; border-radius: 14px;
  font-size: 0.9rem; line-height: 1.05; text-align: center; white-space: normal;
}
#modeClassicBtn   { background: #4da6ff; }
#modeChallengeBtn { background: #ff944d; }
#modeMoodBtn       { background: #66cc66; }

#modeClassicBtn:hover   { background: #3399ff; }
#modeClassicBtn:active  { background: #267acc; transform: translateY(1px) scale(0.96); }
#modeChallengeBtn:hover { background: #ff8533; }
#modeChallengeBtn:active{ background: #e67300; transform: translateY(1px) scale(0.96); }
#modeMoodBtn:hover       { background: #4db84d; }
#modeMoodBtn:active      { background: #339933; transform: translateY(1px) scale(0.96); }

/* ========== 6) Splash Screen ========== */
#splash {
  position: fixed; inset: 0; z-index: 9999;
  display: grid; place-items: center;
  background: linear-gradient(160deg, #9ad4ff 0%, #b8e1ff 40%, #eef7ff 100%);
  opacity: 0; pointer-events: none;
  transition: opacity 400ms ease;
}
@media (prefers-reduced-motion: reduce) { #splash { transition: none; } }
#splash.is-visible { opacity: 1; pointer-events: auto; }
#splash.is-fading-out { opacity: 0; pointer-events: none; }
.splash-inner {
  text-align: center; padding: 2rem 2.5rem; border-radius: 20px;
  background: rgba(255, 255, 255, 0.35);
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
  backdrop-filter: blur(6px);
}
.splash-title { margin: 0 0 0.4rem 0; font-size: clamp(2rem, 6vw, 3.2rem); line-height: 1.1; letter-spacing: 0.5px; color: #0c2a43; text-shadow: 0 1px 0 rgba(255,255,255,0.25); }
.splash-subtitle { margin: 0; font-size: clamp(1rem, 3.2vw, 1.25rem); color: #1a4366; opacity: 0.9; }

/* ========== 7) Login Modal overrides ========== */
#loginModal { place-items: center; z-index: 1000; }
/* Login modal: avoid bottom hairline on some browsers */
#loginModal .modalContent {
  box-shadow: 0 12px 28px rgba(0,0,0,.18);  /* symmetric shadow */
  border: 0;
  outline: 0;
  background-clip: padding-box;             /* prevents border bleed */
  -webkit-font-smoothing: antialiased;
}

#loginModal input[type="text"] { flex: 1 1 auto; border-radius: 10px; border: 1px solid rgba(0,0,0,.15); padding: 8px 10px; }
#loginModal .iconBtn.small { min-width: 64px; }
body.login-active #topBar { display: none; }

.loginHint {
  margin-top: 4px;
  font-size: 12px;
  color: #3a5872;
  opacity: 0.9;
}

/* Study note on Login */
.studyNote {
  margin-top: 6px;
  font-size: 13px;
  line-height: 1.35;
  color: #34536d;
  opacity: 0.95;
}

/* Text button look (for "Feedback (optional)" under login) */
.textBtn {
  margin-top: 6px;
  background: transparent;
  border: none;
  color: #0066cc;
  padding: 6px 0;
  font-size: 14px;
  cursor: pointer;
}
.textBtn:hover { text-decoration: underline; }

/* Feedback modal textarea */
#feedbackModal textarea {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,.15);
  padding: 10px 12px;
  resize: vertical;
}
#feedbackModal.modal {
  z-index: 1000; /* higher than other modals if needed */
}

/* ========== 8) Hidden Webcam & Preview ========== */
.hiddenVideo { position: fixed; left: -9999px; top: 0; width: 320px; height: auto; opacity: 0; pointer-events: none; }
#webcamPreview.preview { position: fixed; right: 16px; bottom: 16px; opacity: 1; width: 160px; border-radius: 8px; box-shadow: 0 6px 20px rgba(0,0,0,.2); transform: scaleX(-1); pointer-events: none; z-index: 9998; }
.camHidden { width: 1px !important; height: 1px !important; opacity: 0 !important; }

/* ========== 9) Centered End-game UI ========== */
.centerMsg { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -60%); font-size: 28px; font-weight: 800; color: #00324d; text-align: center; text-shadow: 0 2px 6px rgba(0,0,0,.25); z-index: 20; }
#restartBtn { position: fixed; left: 50%; top: calc(50% + 24px); transform: translateX(-50%); z-index: 20; border: 0; border-radius: 14px; padding: 12px 16px; font-size: 16px; font-weight: 700; background: #fff; box-shadow: 0 8px 20px rgba(0,0,0,.15); cursor: pointer; display: none; }
#restartBtn:active { transform: translateX(-50%) translateY(1px); }

/* ========== 10) Post-game Modal ========== */
#postGameModal{ place-items: end center; z-index: 15; background: rgba(0,0,0,.20); }
#postGameModal .modalHeader { justify-content: center; }
#postGameTitle { text-align: center; width: 100%; }
#postGameModal .modalContent { width: min(560px, 96vw); border-radius: 16px; box-sizing: border-box; }
#postGameModal .modalRow.stacked { flex-direction: row; justify-content: center; align-items: center; gap: 12px; }
#postGameModal .iconBtn { width: 88px; height: 88px; padding: 8px; border-radius: 14px; font-size: 0.9rem; line-height: 1.05; text-align: center; white-space: normal; }
#postPlayAgain { background: #0077cc; }
#postChangeMode { background: #cc66cc; }
#postPlayAgain:hover  { background: #0066b3; }
#postPlayAgain:active { background: #004c80; transform: translateY(1px) scale(0.96); }
#postChangeMode:hover { background: #b34db3; }
#postChangeMode:active{ background: #993399; transform: translateY(1px) scale(0.96); }
@media (min-height: 700px) { #postGameModal .modalContent { margin-bottom: 20px; } }
@media (max-width: 480px) { #postGameModal .modalContent { width: 100vw; max-width: 100vw; border-radius: 16px; margin-bottom: 12px; } }

/* ========== 11) Responsive Tweaks ========== */
@media (max-width: 420px) {
  .modalPreview { width: 180px; }
}
@media (max-width: 480px) {
  #loginModal .modalRow { flex-direction: column; align-items: stretch; }
  #loginModal input[type="text"] { width: 100%; }
  #loginModal .iconBtn.small    { width: 100%; }
}

/* ========== 12) Utilities ========== */
.hidden     { display: none !important; }
.hiddenChip { visibility: hidden; opacity: 0; pointer-events: none; }
.srOnly     { position: absolute; left: -9999px; }
#overlayUI, #moodChip, #modeChip, #cameraBtn { position: static; }

/* =========================================================
   v9.1.2 — Mobile typing / auto-zoom fixes (iOS & Android)
   Place this block at the very end of style.css
   ========================================================= */

html, body {
  -webkit-text-size-adjust: 100%;  /* iOS text scaling guard */
}

/* KEY: keep inputs/textarea at >=16px to prevent iOS auto-zoom */
input,
select,
textarea {
  font-size: 16px;
  line-height: 1.2;
}

/* Ensure our specific fields also respect the 16px rule */
#loginModal input,
#feedbackModal textarea {
  font-size: 16px;
}

/* Better tap behavior; avoids double-tap zoom on older Safari */
button,
.iconBtn,
.textBtn {
  touch-action: manipulation;
}

/* Optional: keep small icon buttons finger-friendly on mobile */
.iconBtn.small {
  min-height: 36px;
  padding: 6px 10px;
  border-radius: 10px;
  /* if you previously set font-size < 16px anywhere, this helps override */
  font-size: 16px;
}



/* v9.2 — survey styles */
.surveyQ { margin-bottom: 12px; }
.qLabel { font-size: 14px; margin-bottom: 6px; color: #2b4a62; }
.choiceGroup { display: grid; gap: 6px; }
.choiceRow { display: flex; align-items: center; gap: 8px; font-size: 14px; }
.choiceRow input[type="radio"] { transform: scale(1.1); }

@media (max-width: 480px) {
  .qLabel { font-size: 13px; }
  .choiceRow { font-size: 13px; }
}

/* v9.2.1 — compact post-game survey & disabled button state */
.choiceGroup { display: grid; gap: 6px; }
@media (max-width: 480px) {
  .choiceGroup { grid-template-columns: repeat(2, minmax(0,1fr)); }
  .choiceRow { padding: 6px 8px; border-radius: 10px; border: 1px solid rgba(0,0,0,.08); }
  .choiceRow input[type="radio"] { transform: scale(1.2); }
}

.feedbackThanks {
  font-size: 14px;
  color: #2b4a62;
  background: rgba(0,0,0,.04);
  padding: 10px 12px;
  border-radius: 12px;
  margin: 8px 0;
}

/* =========================================================
   v9.2.2 — Login tidy + post-game rows + scrollable survey
   ========================================================= */

/* Login row: compact input + two buttons */
.loginRow {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 10px;
  align-items: center;
}
.loginRow #usernameInput {
  min-width: 0;
  width: 100%;
  font-size: 16px;           /* prevent iOS auto-zoom */
  padding: 10px 12px;
  border: 1px solid rgba(0,0,0,.15);
  border-radius: 10px;
}
.loginRow .btnGroup {
  display: flex;
  gap: 8px;
}

.studyNote {
  margin-top: 6px;
  font-size: 13px;
  line-height: 1.35;
  color: #34536d;
}
.disclaimerBox {
  margin-top: 6px;
  font-size: 13px;
  line-height: 1.4;
  color: #2b4a62;
  background: rgba(0,0,0,.04);
  padding: 10px 12px;
  border-radius: 12px;
}

/* Buttons: colors + hover/active */
.btnPrimary,
.btnAccent,
.iconTile {
  cursor: pointer;
  transition: transform .05s ease, filter .12s ease, background-color .12s ease;
}
.btnPrimary { background: #1a73e8; color: #fff; border: none; border-radius: 10px; padding: 10px 14px; }
.btnPrimary:hover { filter: brightness(1.05); }
.btnPrimary:active { transform: translateY(1px); }

.btnAccent { background: #0aa; color: #fff; border: none; border-radius: 10px; padding: 10px 12px; }
.btnAccent:hover { filter: brightness(1.05); }
.btnAccent:active { transform: translateY(1px); }

/* Post-game tiles with distinct colors */
.iconTile { min-width: 112px; min-height: 84px; border-radius: 16px; border: none; font-size: 14px; }
.tilePlay   { background: #2ea043; color: #fff; }
.tilePlay:hover { filter: brightness(1.05); }
.tilePlay:active { transform: translateY(1px); }

.tileMode   { background: #8a63d2; color: #fff; }
.tileMode:hover { filter: brightness(1.05); }
.tileMode:active { transform: translateY(1px); }

.tileAccent { background: #0aa; color: #fff; }
.tileAccent:hover { filter: brightness(1.05); }
.tileAccent:active { transform: translateY(1px); }

/* Place Feedback on its own row */
.postFeedbackRow { justify-content: center; }

/* Disabled look (reused) */
.iconBtn.is-disabled, .iconTile.is-disabled, .btnAccent.is-disabled {
  opacity: .55; pointer-events: none; filter: grayscale(15%);
}

/* Scrollable survey: fixed header/footer, scrolling body */
#feedbackModal .modalContent {
  display: flex;
  flex-direction: column;
  max-height: min(92vh, 560px);
}
#feedbackModal .modalHeader { flex: 0 0 auto; }
#feedbackModal .modalRow.stacked { flex: 1 1 auto; overflow: auto; }
#feedbackModal .modalRow:last-child { flex: 0 0 auto; }

/* Mobile: two-column radio grid for compactness */
.choiceGroup { display: grid; gap: 6px; }
@media (max-width: 480px) {
  .choiceGroup { grid-template-columns: repeat(2, minmax(0,1fr)); }
  .choiceRow { padding: 6px 8px; border-radius: 10px; border: 1px solid rgba(0,0,0,.08); }
  .choiceRow input[type="radio"] { transform: scale(1.2); }
}
